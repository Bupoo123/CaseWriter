<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CaseWriter - 病例报告撰写助手</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- 顶部导航栏 -->
        <header class="header">
            <div class="container header-top">
                <div class="branding">
                    <div class="logo-container" @click="showVersionInfo = true" style="cursor: pointer;">
                        <img src="assets/images/logo.png" alt="CaseWriter Logo" class="logo-img">
                        <div class="logo-text">
                            <h1 class="logo">CaseWriter</h1>
                            <p class="tagline">智能病例报告撰写与管理工作台</p>
                        </div>
                    </div>
                </div>
                <nav class="nav">
                    <button @click="currentView = 'evaluation'" :class="{ active: currentView === 'evaluation' }">价值评估</button>
                    <button @click="currentView = 'writing'" :class="{ active: currentView === 'writing' }">撰写流程</button>
                    <button @click="currentView = 'guide'" :class="{ active: currentView === 'guide' }">写作指导</button>
                    <button @click="currentView = 'templates'" :class="{ active: currentView === 'templates' }">模板库</button>
                    <button @click="currentView = 'journals'" :class="{ active: currentView === 'journals' }">期刊选择</button>
                    <button @click="currentView = 'manual'" :class="{ active: currentView === 'manual' }">使用手册</button>
                </nav>
            </div>
            <div class="container header-hero">
                <div class="hero-text">
                    <h2>从灵感到发表，一站式完成病例报告</h2>
                    <p>整合 CARE 2013 标准、写作指引与期刊资源，打造高效、优雅的病例报告创作体验。</p>
                    <div class="hero-actions">
                        <button class="btn btn-glow" @click="currentView = 'writing'">立即撰写</button>
                        <button class="btn btn-ghost" @click="currentView = 'evaluation'">评估发表价值</button>
                    </div>
                    <div class="hero-badges">
                        <span class="badge">CARE 2013 标准</span>
                        <span class="badge">模板一键下载</span>
                        <span class="badge">时间线智能整理</span>
                    </div>
                </div>
                <div class="hero-stats">
                    <div class="stat-card">
                        <div class="stat-title">撰写模块</div>
                        <div class="stat-value">15+</div>
                        <div class="stat-desc">覆盖病例报告全流程</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">精选模板</div>
                        <div class="stat-value">40+</div>
                        <div class="stat-desc">高质量期刊案例参考</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">期刊数据</div>
                        <div class="stat-value">120+</div>
                        <div class="stat-desc">支持多维度筛选决策</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- 主内容区 -->
        <main class="main">
            <div class="container">
                <!-- 撰写流程视图 -->
                <div v-if="currentView === 'writing'" class="writing-view panel">
                    <div class="sidebar">
                        <h2>CARE 2013 撰写流程</h2>
                        <ul class="section-nav">
                            <li v-for="(section, index) in careSections" :key="index"
                                @click="activeSection = index"
                                :class="{ active: activeSection === index }">
                                {{ section.title }} <span v-if="section.enTitle">({{ section.enTitle }})</span>
                            </li>
                        </ul>
                        <div class="sidebar-actions">
                            <button @click="newCase" class="btn btn-secondary">新建病例</button>
                            <button @click="saveToLocal" class="btn btn-primary">保存到本地</button>
                            <button @click="exportToWord" class="btn btn-success">导出 Word</button>
                            <button @click="exportToMarkdown" class="btn btn-success">导出 Markdown</button>
                            <button @click="loadFromLocal" class="btn btn-secondary">从本地加载</button>
                        </div>
                    </div>
                    <div class="content-area">
                        <div class="care-progress-card" v-if="complianceOverview.length">
                            <div class="progress-header">
                                <div class="progress-info">
                                    <h3>CARE 合规进度</h3>
                                    <p v-if="careProgress.total">必填章节 {{ careProgress.completed }} / {{ careProgress.total }} 已达标</p>
                                    <p v-else>请开始填写章节以生成合规进度</p>
                                </div>
                                <div class="progress-meter" v-if="careProgress.total">
                                    <div class="meter-bar">
                                        <span :style="{ width: careProgress.percent + '%' }"></span>
                                    </div>
                                    <span class="meter-value">{{ careProgress.percent }}%</span>
                                </div>
                            </div>
                            <div class="progress-chips">
                                <button
                                    v-for="item in complianceOverview"
                                    :key="item.index"
                                    type="button"
                                    class="progress-chip"
                                    :class="['status-' + item.status, { optional: item.optional, active: activeSection === item.index }]"
                                    @click="activeSection = item.index"
                                >
                                    <span class="chip-icon">{{ getStatusIcon(item.status, item.optional) }}</span>
                                    <span class="chip-title">{{ item.title }}</span>
                                    <span class="chip-progress" v-if="item.checklistProgress.total">{{ item.checklistProgress.completed }}/{{ item.checklistProgress.total }}</span>
                                </button>
                            </div>
                        </div>
                        <div v-if="currentSection" class="section-editor">
                            <h2>{{ currentSection.title }} <span v-if="currentSection.enTitle">({{ currentSection.enTitle }})</span></h2>
                            <p class="section-description">{{ currentSection.description }}</p>
                            <div class="section-meta">
                                <div class="meta-item">
                                    <span class="meta-label">估算字数</span>
                                    <span class="meta-value">{{ currentSectionWordCount }}</span>
                                    <span class="meta-hint" v-if="currentSectionWordLimitLabel">{{ currentSectionWordLimitLabel }}</span>
                                </div>
                                <div class="meta-item" v-if="currentChecklistProgress && currentChecklistProgress.total">
                                    <span class="meta-label">核对进度</span>
                                    <span class="meta-value">{{ currentChecklistProgress.completed }}/{{ currentChecklistProgress.total }}</span>
                                    <span class="meta-hint">{{ currentChecklistProgress.percent }}%</span>
                                </div>
                                <div
                                    class="meta-status"
                                    :class="'status-' + ((currentSectionEvaluation && currentSectionEvaluation.status) || 'pending')"
                                >
                                    <span class="status-icon">{{ getStatusIcon(currentSectionEvaluation ? currentSectionEvaluation.status : 'pending', currentSection ? currentSection.optional : false) }}</span>
                                    <span class="status-text">{{ getStatusLabel(currentSectionEvaluation ? currentSectionEvaluation.status : 'pending', currentSection ? currentSection.optional : false) }}</span>
                                </div>
                            </div>
                            <div class="editor-wrapper">
                                <textarea
                                    v-model="careSections[activeSection].content"
                                    class="editor"
                                    :placeholder="currentSection.placeholder"
                                    @input="handleSectionInput(activeSection)"
                                ></textarea>
                            </div>
                            <div v-if="currentSection.checkKey === 'abstract'" class="abstract-helper">
                                <h3>结构化摘要助手</h3>
                                <p class="helper-description">将摘要拆分为 CARE 建议的 5 个模块，系统会自动生成组合文本并同步至编辑器。</p>
                                <div class="abstract-grid">
                                    <div class="abstract-field">
                                        <label>Introduction（背景）<span class="word-hint">{{ getWordCount(abstractForm.introduction) }} 词</span></label>
                                        <textarea v-model="abstractForm.introduction" placeholder="聚焦诊断挑战、罕见性与 CARE 声明"></textarea>
                                    </div>
                                    <div class="abstract-field">
                                        <label>Case Presentation（病例介绍）<span class="word-hint">{{ getWordCount(abstractForm.casePresentation) }} 词</span></label>
                                        <textarea v-model="abstractForm.casePresentation" placeholder="概述人口学信息、关键检查与时间顺序"></textarea>
                                    </div>
                                    <div class="abstract-field">
                                        <label>Management and Outcomes（诊疗与结局）<span class="word-hint">{{ getWordCount(abstractForm.management) }} 词</span></label>
                                        <textarea v-model="abstractForm.management" placeholder="说明干预策略、调整、不良事件与结局"></textarea>
                                    </div>
                                    <div class="abstract-field">
                                        <label>Conclusion（结论）<span class="word-hint">{{ getWordCount(abstractForm.conclusion) }} 词</span></label>
                                        <textarea v-model="abstractForm.conclusion" placeholder="用 1-2 句话总结核心收获"></textarea>
                                    </div>
                                    <div class="abstract-field full-width">
                                        <label>Learning Points（教学要点）<span class="word-hint">{{ getWordCount(abstractForm.learningPoints) }} 词</span></label>
                                        <textarea v-model="abstractForm.learningPoints" placeholder="每行填写 1 条要点，系统自动生成条目列表"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div v-if="currentSection.checkKey === 'keywords'" class="keyword-helper">
                                <h3>关键词质量监控</h3>
                                <div class="keyword-status">
                                    <span>当前共 {{ currentSectionKeywords.length }} 个关键词</span>
                                    <span v-if="!currentKeywordIncludesCaseReport" class="status-alert">需包含 "case report/病例报告"</span>
                                    <span v-else class="status-ok">已包含病例报告关键词</span>
                                </div>
                                <div class="keyword-chips" v-if="currentSectionKeywords.length">
                                    <span v-for="(keyword, kIndex) in currentSectionKeywords" :key="kIndex" class="keyword-chip">{{ keyword }}</span>
                                </div>
                                <p class="helper-description">建议保留 3-6 个标准化术语（优选 MeSH），覆盖疾病、病原、诊断技术与人群特征。</p>
                            </div>
                            <!-- 时间线事件编辑器（仅在第7章显示） -->
                            <div v-if="currentSection.title.startsWith('7.')" class="timeline-tool">
                                <h3>时间线事件编辑器</h3>
                                <div class="timeline-form">
                                    <input type="date" v-model="timelineForm.date" class="filter-input" />
                                    <input type="text" v-model="timelineForm.event" placeholder="事件/检查/治疗" class="filter-input" />
                                    <input type="text" v-model="timelineForm.note" placeholder="备注（可选）" class="filter-input" />
                                    <button class="btn btn-primary" @click="addTimelineEvent">添加</button>
                                </div>
                                <div class="timeline-scroll" v-if="timelineEvents.length">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>日期</th>
                                                <th>事件</th>
                                                <th>备注</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="(ev, i) in timelineEvents" :key="i">
                                                <td>{{ ev.date }}</td>
                                                <td>{{ ev.event }}</td>
                                                <td>{{ ev.note }}</td>
                                                <td><button class="btn btn-sm" @click="removeTimelineEvent(i)">删除</button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <button v-if="timelineEvents.length" class="btn btn-success" @click="syncTimelineToContent">同步为表格到编辑器</button>
                            </div>
                            <div class="guideline-focus" v-if="currentSection.guidelineFocus && currentSection.guidelineFocus.length">
                                <h3>指南要点</h3>
                                <ul>
                                    <li v-for="(focus, focusIndex) in currentSection.guidelineFocus" :key="focusIndex">{{ focus }}</li>
                                </ul>
                            </div>
                            <div class="section-checklist" v-if="currentSection.checklist && currentSection.checklist.length">
                                <div class="checklist-header">
                                    <h3>CARE 核对点</h3>
                                    <span>{{ currentChecklistProgress.completed }}/{{ currentChecklistProgress.total }}</span>
                                </div>
                                <ul>
                                    <li v-for="(item, itemIndex) in currentSection.checklist" :key="itemIndex">
                                        <label class="checklist-item">
                                            <input type="checkbox" :checked="isChecklistItemChecked(activeSection, itemIndex)" @change="toggleChecklistItem(activeSection, itemIndex)" />
                                            <span>{{ item }}</span>
                                        </label>
                                    </li>
                                </ul>
                            </div>
                            <div class="section-diagnostics" v-if="currentSectionEvaluation && currentSectionEvaluation.issues && currentSectionEvaluation.issues.length">
                                <h3>实时诊断</h3>
                                <ul>
                                    <li v-for="(issue, issueIndex) in currentSectionEvaluation.issues" :key="issueIndex" :class="['diagnostic-item', 'level-' + issue.level]">
                                        <span class="issue-icon">{{ issue.level === 'error' ? '⛔' : '⚠️' }}</span>
                                        <span>{{ issue.text }}</span>
                                    </li>
                                </ul>
                            </div>
                            <div class="section-diagnostics success" v-else-if="currentSectionEvaluation && currentSectionEvaluation.status === 'pass'">
                                <span class="issue-icon">✅</span>
                                <span>章节内容已覆盖 CARE 关键要求。</span>
                            </div>
                            <div class="section-diagnostics neutral" v-else-if="currentSectionEvaluation && currentSectionEvaluation.status === 'optional'">
                                <span class="issue-icon">◇</span>
                                <span>该章节为 CARE 可选项，可视需要补充患者声音。</span>
                            </div>
                            <div class="writing-tips" v-if="careSections[activeSection].tips">
                                <h3>写作提示</h3>
                                <ul>
                                    <li v-for="(tip, tipIndex) in careSections[activeSection].tips" :key="tipIndex">{{ tip }}</li>
                                </ul>
                            </div>
                        </div>
                        <div v-else class="welcome-screen">
                            <h2>欢迎使用 CaseWriter</h2>
                            <p>请从左侧选择要撰写的章节开始</p>
                        </div>
                    </div>
                </div>

                <!-- 写作指导视图 -->
                <div v-if="currentView === 'guide'" class="guide-view panel">
                    <h2>写作指导与知识库</h2>
                    <div class="guide-content">
                        <div class="guide-section" v-for="(guide, index) in writingGuides" :key="index">
                            <h3>{{ guide.title }}</h3>
                            <div class="guide-body">
                                <div v-if="guide.type === 'tips'">
                                    <ul>
                                        <li v-for="(tip, tipIndex) in guide.content" :key="tipIndex">{{ tip }}</li>
                                    </ul>
                                </div>
                                <div v-else-if="guide.type === 'accordion'" class="guide-accordion">
                                    <details v-for="(item, itemIndex) in guide.content" :key="itemIndex" :open="itemIndex === 0">
                                        <summary>
                                            <span>{{ item.title }}</span>
                                            <span class="accordion-icon" aria-hidden="true"></span>
                                        </summary>
                                        <div class="accordion-body">
                                            <template v-if="item.bodyType === 'tips'">
                                                <ul>
                                                    <li v-for="(tip, tipIndex) in item.body" :key="tipIndex">{{ tip }}</li>
                                                </ul>
                                            </template>
                                            <template v-else-if="item.bodyType === 'example'">
                                                <pre><code>{{ item.body }}</code></pre>
                                            </template>
                                            <template v-else>
                                                <p v-for="(para, paraIndex) in item.body" :key="paraIndex">{{ para }}</p>
                                            </template>
                                        </div>
                                    </details>
                                </div>
                                <div v-else-if="guide.type === 'example'">
                                    <pre><code>{{ guide.content }}</code></pre>
                                </div>
                                <div v-else>
                                    <p v-for="(para, paraIndex) in guide.content" :key="paraIndex">{{ para }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 价值评估视图 -->
                <div v-if="currentView === 'evaluation'" class="evaluation-view panel">
                    <h2>Case Report 发表价值评估</h2>
                    <p class="intro-text">本模块帮助您评估病例报告的发表价值，判断该案例是否值得发表。</p>
                    <div class="title-pattern">
                        <strong>什么样的临床病例适合投 Case？</strong>
                        <ul>
                            <li>病例报告涵盖的临床问题主要包括：先前未报告的药物或其他治疗的不良反应、在观察或治疗患者过程中发生的意外事件、关于疾病发病机制的观察、新发和突发疾病的临床表现和/或管理、新的治疗方法、患者管理中的伦理挑战以及预防或克服医疗错误的策略。</li>
                            <li>通过分析已报道的 mNGS 病例报告，发现这些病例通常具有“独特性”：例如与既往病例或常规诊疗不同，如新的解决方案、新的病原体、新的合并症等。</li>
                        </ul>
                    </div>

                    <!-- 发表的典型特征 -->
                    <div class="evaluation-section">
                        <h3>一、发表的典型特征（哪些值得发表）</h3>
                        <div class="feature-list">
                            <div class="feature-item" v-for="(feature, index) in publicationFeatures" :key="index">
                                <div class="feature-number">{{ index + 1 }}️⃣</div>
                                <div class="feature-content">
                                    <h4>{{ feature.title }}</h4>
                                    <p class="feature-examples">{{ feature.examples }}</p>
                                    <p class="feature-reason"><strong>发表理由：</strong>{{ feature.reason }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 评估维度表格 -->
                    <div class="evaluation-section">
                        <h3>二、评估维度与发表价值</h3>
                        <div class="evaluation-table-wrapper">
                            <table class="evaluation-table">
                                <thead>
                                    <tr>
                                        <th>评估维度</th>
                                        <th>描述</th>
                                        <th>发表价值</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="(dimension, index) in evaluationDimensions" :key="index">
                                        <td><strong>{{ dimension.dimension }}</strong></td>
                                        <td>{{ dimension.description }}</td>
                                        <td>
                                            <span class="value-stars">{{ dimension.value }}</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 投稿期刊分布 -->
                    <div class="evaluation-section">
                        <h3>三、投稿期刊分布特点</h3>
                        <ul class="journal-distribution">
                            <li><strong>Frontiers 系列</strong>（Public Health, Cell Infect Microbiol, Medicine）占比高</li>
                            <li><strong>BMC 系列</strong>、Heliyon、Infect Drug Resist 为主流开放获取渠道</li>
                            <li>大多属 <strong>OA 期刊</strong>，APC 1000–3000 美元范围</li>
                            <li>说明此类 mNGS 病例目前投稿难度适中，重在病例质量与新颖性</li>
                        </ul>
                    </div>
                    <div class="evaluation-section self-check-section">
                        <h3>四、CARE 合规自检工具</h3>
                        <div class="self-check-header">
                            <div
                                class="self-check-progress"
                                :style="{ '--percent': selfCheckProgress.percent || 0 }"
                                :data-label="selfCheckProgress.percent + '%'"
                            ></div>
                            <p>勾选下列关键事项，确保提交前满足 CARE 指南对透明度、伦理与信息完整性的要求。</p>
                        </div>
                        <div class="self-checklist">
                            <label v-for="item in careSelfCheckItems" :key="item.id" class="self-check-item">
                                <input type="checkbox" :checked="item.checked" @change="toggleSelfCheck(item.id)" />
                                <div class="self-check-text">
                                    <span class="self-check-title">{{ item.text }}</span>
                                    <span class="self-check-hint">{{ item.hint }}</span>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- 模板库视图 -->
                <div v-if="currentView === 'templates'" class="templates-view panel">
                    <h2>模板与案例库</h2>
                    <p class="intro-text">下载CARE指南和清单、杰毅生物合作发表案例和经典高分案例</p>
                    
                    <div class="filter-bar">
                        <input type="text" v-model="templateFilter" placeholder="搜索模板或案例..." class="filter-input">
                        <select v-model="templateCategoryFilter" class="filter-select">
                            <option value="">所有分类</option>
                            <option value="指南和清单">指南和清单</option>
                            <option value="杰毅生物合作发表案例">杰毅生物合作发表案例</option>
                            <option value="经典高分案例">经典高分案例</option>
                        </select>
                    </div>

                    <div v-if="loadingTemplates" class="loading">加载中...</div>
                    <div v-else-if="filteredTemplateGroups.length === 0" class="no-results">未找到匹配的模板或案例</div>
                    <div v-else class="template-groups">
                        <div v-for="group in filteredTemplateGroups" :key="group.category" class="template-category-group">
                            <button
                                type="button"
                                class="template-group-header"
                                @click="toggleTemplateCategory(group.category)"
                                :aria-expanded="isTemplateCategoryExpanded(group.category)"
                            >
                                <div class="template-group-info">
                                    <span class="template-group-title">{{ group.category }}</span>
                                    <span class="template-group-count">共 {{ group.items.length }} 个资源</span>
                                </div>
                                <span class="template-group-toggle" :class="{ expanded: isTemplateCategoryExpanded(group.category) }" aria-hidden="true"></span>
                            </button>
                            <transition name="collapse">
                                <div v-if="isTemplateCategoryExpanded(group.category)" class="templates-grid">
                                    <div v-for="item in group.items" :key="item.id" class="template-card">
                                        <div class="template-header">
                                            <h3>{{ item.name }}</h3>
                                            <span class="template-category">{{ group.category }}</span>
                                        </div>
                                        <p class="template-description">{{ item.description }}</p>
                                        <div class="template-meta">
                                            <span v-if="item.journal" class="meta-item">期刊: {{ item.journal }}</span>
                                            <span v-if="item.year" class="meta-item">年份: {{ item.year }}</span>
                                            <span class="meta-item">格式: {{ item.format }}</span>
                                            <span class="meta-item">大小: {{ item.size }}</span>
                                        </div>
                                        <div v-if="item.tags && item.tags.length" class="template-tags">
                                            <span v-for="tag in item.tags" :key="tag" class="tag">{{ tag }}</span>
                                        </div>
                                        <div class="template-actions">
                                            <button v-if="item.files && item.files.length > 1" @click="showMultiFileDialog(item)" class="btn btn-primary">下载 ({{ item.files.length }}个文件)</button>
                                            <a v-else :href="getDownloadUrl(item)" target="_blank" class="btn btn-primary">下载</a>
                                            <a v-if="item.format === 'pdf'" :href="getDownloadUrl(item)" target="_blank" class="btn btn-secondary">在线查看</a>
                                        </div>
                                    </div>
                                </div>
                            </transition>
                        </div>
                    </div>

                    <!-- 多文件下载对话框 -->
                    <div v-if="selectedMultiFileItem" class="modal-overlay" @click="selectedMultiFileItem = null">
                        <div class="modal-content" @click.stop>
                            <h3>{{ selectedMultiFileItem.name }}</h3>
                            <p>该案例包含多个文件，请选择要下载的文件：</p>
                            <ul class="file-list">
                                <li v-for="(file, index) in selectedMultiFileItem.files" :key="index">
                                    <a :href="getFileDownloadUrl(file)" target="_blank" class="file-link">{{ getFileName(file) }}</a>
                                </li>
                            </ul>
                            <button @click="selectedMultiFileItem = null" class="btn btn-secondary">关闭</button>
                        </div>
                    </div>
                </div>

                <!-- 期刊选择视图 -->
                <div v-if="currentView === 'journals'" class="journals-view panel">
                    <h2>期刊选择与模板下载</h2>
                    <div class="filter-bar">
                        <input type="text" v-model="journalFilter" placeholder="搜索期刊..." class="filter-input">
                        <select v-model="journalTopicFilter" class="filter-select">
                            <option value="">所有主题</option>
                            <option v-for="topic in journalTopics" :key="topic" :value="topic">{{ topic }}</option>
                        </select>
                        <select v-model="journalOAFilter" class="filter-select">
                            <option value="">所有类型</option>
                            <option value="是">开放获取</option>
                            <option value="否">非开放获取</option>
                        </select>
                        <select v-model="journalAcceptsFilter" class="filter-select">
                            <option value="">接收病例报告（全部）</option>
                            <option value="接收">仅接收</option>
                            <option value="不接收">不接收</option>
                        </select>
                        <label style="display:flex;align-items:center;gap:0.3rem;">
                            <input type="checkbox" v-model="journalVerifiedOnly"> 仅显示已验证链接
                        </label>
                        <label style="display:flex;align-items:center;gap:0.3rem;">
                            <input type="checkbox" v-model="showAdvancedJournalFields"> 显示高级字段
                        </label>
                    </div>
                    <div class="journals-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>期刊名称</th>
                                    <th>主题方向</th>
                                    <th>出版社</th>
                                    <th>是否OA</th>
                                    <th>APC</th>
                                    <th v-if="showAdvancedJournalFields">2025 IF</th>
                                    <th v-if="showAdvancedJournalFields">5-Year IF</th>
                                    <th v-if="showAdvancedJournalFields">JCR分区</th>
                                    <th v-if="showAdvancedJournalFields">中科院分区</th>
                                    <th v-if="showAdvancedJournalFields">ISSN/eISSN</th>
                                    <th v-if="showAdvancedJournalFields">接受Case</th>
                                    <th v-if="showAdvancedJournalFields">预警状态</th>
                                    <th v-if="showAdvancedJournalFields">验证</th>
                                    <th>投稿网址</th>
                                    <th>模板链接</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="(journal, index) in filteredJournals" :key="index">
                                    <td>{{ journal.name || '-' }}</td>
                                    <td>{{ journal.topic }}</td>
                                    <td>{{ journal.publisher }}</td>
                                    <td>{{ journal.oa }}</td>
                                    <td>{{ journal.apc }}</td>
                                    <td v-if="showAdvancedJournalFields">{{ journal.if2025 || '-' }}</td>
                                    <td v-if="showAdvancedJournalFields">{{ journal.if5year || '-' }}</td>
                                    <td v-if="showAdvancedJournalFields">{{ journal.jifQuartile || '-' }}</td>
                                    <td v-if="showAdvancedJournalFields">{{ journal.casDivision || '-' }}</td>
                                    <td v-if="showAdvancedJournalFields">{{ (journal.issn || '-') + (journal.eissn ? (' / ' + journal.eissn) : '') }}</td>
                                    <td v-if="showAdvancedJournalFields">{{ journal.acceptsCaseReport ? '是' : '否' }}</td>
                                    <td v-if="showAdvancedJournalFields">{{ journal.warningStatus || '正常' }}</td>
                                    <td v-if="showAdvancedJournalFields">{{ journal.verified ? '已验证' : '未验证' }}</td>
                                    <td><a :href="journal.submissionUrl" target="_blank">投稿链接</a></td>
                                    <td><a :href="journal.templateUrl" target="_blank">模板链接</a></td>
                                    <td>
                                        <button @click="openJournal(journal.submissionUrl)" class="btn btn-sm">投稿</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 使用手册视图 -->
                <div v-if="currentView === 'manual'" class="manual-view panel">
                    <h2>CaseWriter 用户使用手册</h2>
                    <p class="intro-text">欢迎使用 CaseWriter！本手册将帮助您快速了解软件的各项功能和使用方法。</p>

                    <div class="manual-content">
                        <!-- 一、软件介绍 -->
                        <section class="manual-section">
                            <h3>一、软件介绍</h3>
                            <div class="manual-body">
                                <p><strong>CaseWriter</strong> 是一款基于 CARE 2013 标准的病例报告撰写助手，旨在帮助临床医生和研究人员高效、规范地完成病例报告的撰写工作。</p>
                                <div class="feature-list">
                                    <div class="feature-item">
                                        <strong>核心特性：</strong>
                                        <ul>
                                            <li>✅ 遵循 CARE 2013 国际标准，确保报告规范性</li>
                                            <li>✅ 实时合规进度追踪，随时掌握撰写状态</li>
                                            <li>✅ 结构化摘要助手，自动生成标准格式</li>
                                            <li>✅ 关键词质量监控，提升检索效率</li>
                                            <li>✅ 章节核对清单，确保内容完整性</li>
                                            <li>✅ 实时诊断反馈，及时发现并修正问题</li>
                                            <li>✅ 时间线智能整理，自动生成表格</li>
                                            <li>✅ 本地数据存储，保护隐私安全</li>
                                            <li>✅ 一键导出 Word/Markdown，方便后续编辑</li>
                                            <li>✅ 丰富的模板库和期刊资源</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 二、快速开始 -->
                        <section class="manual-section">
                            <h3>二、快速开始</h3>
                            <div class="manual-body">
                                <div class="step-item">
                                    <h4>步骤 1：新建病例</h4>
                                    <p>点击左侧边栏的 <strong>"新建病例"</strong> 按钮，清空所有内容，开始撰写新的病例报告。</p>
                                </div>
                                <div class="step-item">
                                    <h4>步骤 2：选择章节</h4>
                                    <p>在左侧导航栏中选择要撰写的章节（如"1. 标题"、"2. 关键词"等），系统会显示该章节的详细说明和写作提示。</p>
                                </div>
                                <div class="step-item">
                                    <h4>步骤 3：填写内容</h4>
                                    <p>在编辑器中填写章节内容，系统会实时保存到本地存储，无需担心数据丢失。</p>
                                </div>
                                <div class="step-item">
                                    <h4>步骤 4：查看进度</h4>
                                    <p>在撰写流程页面顶部查看 <strong>CARE 合规进度</strong>，了解哪些章节已完成，哪些需要补充。</p>
                                </div>
                                <div class="step-item">
                                    <h4>步骤 5：导出文档</h4>
                                    <p>完成撰写后，点击 <strong>"导出 Word"</strong> 或 <strong>"导出 Markdown"</strong> 按钮，生成最终文档。</p>
                                </div>
                            </div>
                        </section>

                        <!-- 三、功能模块详解 -->
                        <section class="manual-section">
                            <h3>三、功能模块详解</h3>
                            <div class="manual-body">
                                <div class="module-item">
                                    <h4>3.1 撰写流程</h4>
                                    <p>这是软件的核心模块，包含 14 个章节，完全遵循 CARE 2013 标准：</p>
                                    <ul>
                                        <li><strong>合规进度卡片：</strong>显示所有章节的完成状态，点击章节卡片可快速跳转</li>
                                        <li><strong>章节元数据：</strong>显示当前章节的字数、核对进度和合规状态</li>
                                        <li><strong>结构化摘要助手：</strong>在"3. 摘要"章节，可将摘要拆分为 5 个模块分别填写</li>
                                        <li><strong>关键词质量监控：</strong>在"2. 关键词"章节，自动检测关键词数量和格式</li>
                                        <li><strong>时间线编辑器：</strong>在"7. 时间线"章节，可添加事件并自动生成表格</li>
                                        <li><strong>指南要点：</strong>每个章节都显示 CARE 指南的核心要求</li>
                                        <li><strong>核对清单：</strong>可勾选完成的关键核对点</li>
                                        <li><strong>实时诊断：</strong>自动检测内容问题并给出改进建议</li>
                                    </ul>
                                </div>

                                <div class="module-item">
                                    <h4>3.2 价值评估</h4>
                                    <p>帮助您判断病例报告的发表价值：</p>
                                    <ul>
                                        <li><strong>发表的典型特征：</strong>了解哪些类型的病例值得发表</li>
                                        <li><strong>评估维度表格：</strong>从多个维度评估病例价值</li>
                                        <li><strong>投稿期刊分布：</strong>了解常见投稿期刊特点</li>
                                        <li><strong>CARE 合规自检工具：</strong>提交前的最终检查清单</li>
                                    </ul>
                                </div>

                                <div class="module-item">
                                    <h4>3.3 写作指导</h4>
                                    <p>提供详细的写作知识和技巧：</p>
                                    <ul>
                                        <li>CARE 指南核心原则</li>
                                        <li>标题与关键词快速校验</li>
                                        <li>结构式摘要模板</li>
                                        <li>患者信息采集要点</li>
                                        <li>诊疗与随访记录技巧</li>
                                        <li>讨论写作骨架</li>
                                        <li>伦理与隐私提醒</li>
                                        <li>常见写作错误</li>
                                    </ul>
                                </div>

                                <div class="module-item">
                                    <h4>3.4 模板库</h4>
                                    <p>提供丰富的模板和案例资源：</p>
                                    <ul>
                                        <li><strong>指南和清单：</strong>CARE 核对清单、指南文件</li>
                                        <li><strong>杰毅生物合作发表案例：</strong>团队已发表的病例报告</li>
                                        <li><strong>经典高分案例：</strong>高质量期刊的经典案例</li>
                                        <li>支持按分类筛选和关键词搜索</li>
                                        <li>一键下载，方便参考学习</li>
                                    </ul>
                                </div>

                                <div class="module-item">
                                    <h4>3.5 期刊选择</h4>
                                    <p>帮助您选择合适的投稿期刊：</p>
                                    <ul>
                                        <li>包含 120+ 期刊的详细信息</li>
                                        <li>支持按主题、OA 类型、是否接收病例报告等条件筛选</li>
                                        <li>显示影响因子、JCR 分区、中科院分区等关键指标</li>
                                        <li>提供投稿链接和模板下载链接</li>
                                        <li>可显示高级字段（IF、ISSN、验证状态等）</li>
                                    </ul>
                                </div>
                            </div>
                        </section>

                        <!-- 四、使用技巧 -->
                        <section class="manual-section">
                            <h3>四、使用技巧</h3>
                            <div class="manual-body">
                                <div class="tip-item">
                                    <h4>💡 技巧 1：充分利用合规进度</h4>
                                    <p>在撰写流程页面顶部的进度卡片中，可以快速查看所有章节的状态。绿色表示已达标，黄色表示需优化，红色表示不符合要求。点击章节卡片可快速跳转到对应章节。</p>
                                </div>
                                <div class="tip-item">
                                    <h4>💡 技巧 2：使用结构化摘要助手</h4>
                                    <p>在"3. 摘要"章节，使用结构化摘要助手可以更清晰地组织摘要内容。系统会自动将 5 个模块的内容组合成完整的摘要文本。</p>
                                </div>
                                <div class="tip-item">
                                    <h4>💡 技巧 3：关注实时诊断</h4>
                                    <p>每个章节下方都会显示实时诊断信息，包括错误（⛔）和警告（⚠️）。及时处理这些问题可以提升报告质量。</p>
                                </div>
                                <div class="tip-item">
                                    <h4>💡 技巧 4：使用核对清单</h4>
                                    <p>每个章节都提供了 CARE 核对清单，勾选完成的项目可以帮助您确保内容完整性。</p>
                                </div>
                                <div class="tip-item">
                                    <h4>💡 技巧 5：时间线自动生成</h4>
                                    <p>在"7. 时间线"章节，使用时间线编辑器添加事件后，点击"同步为表格到编辑器"按钮，可以自动生成格式化的 Markdown 表格。</p>
                                </div>
                                <div class="tip-item">
                                    <h4>💡 技巧 6：定期保存</h4>
                                    <p>虽然系统会自动保存，但建议在重要节点点击"保存到本地"按钮，确保数据安全。数据保存在浏览器本地存储中，不会上传到服务器。</p>
                                </div>
                                <div class="tip-item">
                                    <h4>💡 技巧 7：参考模板库</h4>
                                    <p>在撰写过程中，可以随时查看模板库中的案例，学习优秀的写作方法和格式。</p>
                                </div>
                            </div>
                        </section>

                        <!-- 五、常见问题 -->
                        <section class="manual-section">
                            <h3>五、常见问题</h3>
                            <div class="manual-body">
                                <div class="faq-item">
                                    <h4>Q1：数据会丢失吗？</h4>
                                    <p><strong>A：</strong>不会。系统会自动保存到浏览器本地存储（LocalStorage），即使关闭浏览器，数据也会保留。但请注意，清除浏览器缓存会删除本地存储的数据，建议定期使用"保存到本地"功能。</p>
                                </div>
                                <div class="faq-item">
                                    <h4>Q2：可以同时编辑多个病例吗？</h4>
                                    <p><strong>A：</strong>当前版本每次只能编辑一个病例。如果需要开始新病例，请点击"新建病例"按钮，系统会清空当前内容。建议在新建前先导出当前病例。</p>
                                </div>
                                <div class="faq-item">
                                    <h4>Q3：导出的 Word 文档格式不对怎么办？</h4>
                                    <p><strong>A：</strong>导出的 Word 文档是 HTML 格式，可以在 Word 中打开后进一步调整格式。也可以导出 Markdown 格式，使用 Markdown 编辑器打开。</p>
                                </div>
                                <div class="faq-item">
                                    <h4>Q4：如何判断章节是否达标？</h4>
                                    <p><strong>A：</strong>查看章节元数据中的状态标识：✅ 已达标、⚠️ 需优化、❗️ 不符合、◇ 可选。也可以查看实时诊断信息，了解具体需要改进的地方。</p>
                                </div>
                                <div class="faq-item">
                                    <h4>Q5：关键词数量有要求吗？</h4>
                                    <p><strong>A：</strong>建议 3-6 个关键词，且必须包含 "case report" 或 "病例报告"。系统会在关键词章节显示质量监控信息。</p>
                                </div>
                                <div class="faq-item">
                                    <h4>Q6：摘要的字数要求是什么？</h4>
                                    <p><strong>A：</strong>建议 100-250 词。系统会实时显示当前字数，并在超出范围时给出提示。</p>
                                </div>
                                <div class="faq-item">
                                    <h4>Q7：模板库的文件无法下载？</h4>
                                    <p><strong>A：</strong>模板库的文件存储在 GitHub Releases 上，需要网络连接。如果无法下载，请检查网络连接或稍后重试。</p>
                                </div>
                                <div class="faq-item">
                                    <h4>Q8：如何恢复之前保存的数据？</h4>
                                    <p><strong>A：</strong>点击"从本地加载"按钮即可恢复之前保存的数据。系统在页面加载时会自动尝试恢复上次的数据。</p>
                                </div>
                            </div>
                        </section>

                        <!-- 六、注意事项 -->
                        <section class="manual-section">
                            <h3>六、注意事项</h3>
                            <div class="manual-body">
                                <div class="notice-item">
                                    <h4>⚠️ 数据安全</h4>
                                    <ul>
                                        <li>所有数据仅保存在浏览器本地，不会上传到服务器</li>
                                        <li>清除浏览器缓存会删除本地存储的数据</li>
                                        <li>建议定期导出文档作为备份</li>
                                        <li>不要在公共电脑上保存敏感信息</li>
                                    </ul>
                                </div>
                                <div class="notice-item">
                                    <h4>⚠️ 隐私保护</h4>
                                    <ul>
                                        <li>填写患者信息时务必进行去标识化处理</li>
                                        <li>不要在内容中包含患者姓名、身份证号等可识别信息</li>
                                        <li>导出文档前请再次检查隐私信息</li>
                                    </ul>
                                </div>
                                <div class="notice-item">
                                    <h4>⚠️ 格式要求</h4>
                                    <ul>
                                        <li>导出的 Word 文档可能需要进一步调整格式</li>
                                        <li>建议根据目标期刊要求调整文档格式</li>
                                        <li>参考文献格式需符合目标期刊要求</li>
                                    </ul>
                                </div>
                            </div>
                        </section>

                        <!-- 七、技术支持 -->
                        <section class="manual-section">
                            <h3>七、技术支持</h3>
                            <div class="manual-body">
                                <p>如果您在使用过程中遇到问题，可以：</p>
                                <ul>
                                    <li>查看本使用手册的相关章节</li>
                                    <li>参考"写作指导"模块中的详细说明</li>
                                    <li>查看模板库中的案例示例</li>
                                    <li>联系技术支持团队</li>
                                </ul>
                                <p class="version-info">当前版本：CaseWriter V1.2</p>
                                <p class="version-info">更新日期：2025-01-13</p>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </main>

        <!-- 底部信息 -->
        <footer class="footer">
            <div class="container">
                <p>CaseWriter V1.2 - 基于 CARE 2013 标准的病例报告撰写助手</p>
                <p style="margin-top: 0.5rem; font-size: 0.9rem;">
                    <a href="#" @click.prevent="currentView = 'manual'" style="color: rgba(255,255,255,0.8); text-decoration: none;">使用手册</a>
                </p>
            </div>
        </footer>

        <!-- 版本信息模态框 -->
        <div v-if="showVersionInfo" class="modal-overlay" @click="showVersionInfo = false">
            <div class="modal-content version-modal" @click.stop>
                <div class="version-header">
                    <img src="assets/images/logo.png" alt="CaseWriter Logo" class="version-logo">
                    <h2>CaseWriter</h2>
                </div>
                <div class="version-body">
                    <div class="version-item">
                        <span class="version-label">版本号：</span>
                        <span class="version-value">V1.2</span>
                    </div>
                    <div class="version-item">
                        <span class="version-label">开发团队：</span>
                        <span class="version-value">杰毅生物研发中心</span>
                    </div>
                    <div class="version-item">
                        <span class="version-label">联系邮箱：</span>
                        <a href="mailto:hanxu@matridx.com" class="version-value version-link">hanxu@matridx.com</a>
                    </div>
                    <div class="version-item">
                        <span class="version-label">基于标准：</span>
                        <span class="version-value">CARE 2013 Guidelines</span>
                    </div>
                    <div class="version-item">
                        <span class="version-label">更新日期：</span>
                        <span class="version-value">2025-01-13</span>
                    </div>
                </div>
                <div class="version-footer">
                    <button class="btn btn-primary" @click="showVersionInfo = false">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>

